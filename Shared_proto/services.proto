syntax = "proto3";
option java_multiple_files = true;
option java_package = "com.respawnmarket";
option java_outer_classname = "ReSpawnMarketServiceProto";
package com.respawnmarket;
import "google/protobuf/timestamp.proto";

//  Data Models(database entities)
message Customer
{
  int32 id = 1;
  string first_name = 2;
  string last_name = 3;
  string email = 4;
  string password = 5;
  string phone_number = 6;
  bool can_sell = 7;
}

message Address
{
  int32 id = 1;
  string street_name = 2;
  string secondary_unit = 3;
  int32 postal_code = 4;
}

message Postal
{
  int32 postal_code = 1;
  string city = 2;
}

message CustomerAddress
{
  int32 customer_id = 1;
  int32 address_id = 2;
}

message Reseller
{
  int32 id = 1;
  string name = 2;
  string username = 3;
  string password = 4;
}

enum ApprovalStatus
{
  PENDING = 0;
  REVIEWING = 1;
  APPROVED = 2;
  REJECTED = 3;
}

enum Category
{
  CATEGORY_UNSPECIFIED = 0;
  ELECTRONICS = 1;
  JEWELRY = 2;
  WATCHES = 3;
  MUSICAL_INSTRUMENTS = 4;
  TOOLS = 5;
  VEHICLES = 6;
  COLLECTIBLES = 7;
  FASHION = 8;
  HOME_APPLIANCES = 9;
  SPORTS_EQUIPMENT = 10;
  COMPUTERS = 11;
  MOBILE_PHONES = 12;
  CAMERAS = 13;
  LUXURY_ITEMS = 14;
  ARTWORK = 15;
  ANTIQUES = 16;
  GAMING_CONSOLES = 17;
  FURNITURE = 18;
  GOLD_AND_SILVER = 19;
  OTHER = 20;
}

message Image
{
  int32 id = 1;
  string url = 2;
  int32 product_id = 3;
}

message Product
{
  int32 id = 1;
  double price = 2;
  bool sold = 3;
  string condition = 4;
  ApprovalStatus approval_status = 5;
  string name = 6;
  Category category = 7;
  string description = 8;
  int32 sold_by_customer_id = 9;
  google.protobuf.Timestamp register_date = 10;
  string other_category = 11;
  int32 pawnshop_id = 12;
}
// Transaction entity representing a purchase and its details
message Transaction
{
  int32 id = 1;
  google.protobuf.Timestamp date = 2;
  int32 shopping_cart_id = 3;
  int32 customer_id = 4;
}
message CartItem
{
  int32 product_id = 1;
  int32 quantity = 2;
}
message BuyProductsRequest
{
  int32 customer_id = 1;
  repeated CartItem items = 2;
}
message BuyProductsResponse
{
  Transaction transaction = 1;
  ShoppingCart shopping_cart = 2;
  repeated CartProduct cart_products = 3;
  repeated Product purchased_products = 4;
}

message ShoppingCart
{
  int32 id = 1;
  double total_price = 2;
}

message CartProduct
{
  int32 cart_id = 1;
  int32 product_id = 2;
  int32 quantity = 3;
}

//  Request(parameter) and Response(return) Messages for Logic Service
message RegisterCustomerRequest
{
  string first_name = 1;
  string last_name = 2;
  string email = 3;
  string password = 4;
  string phone_number = 5;
  string street_name = 6;
  string secondary_unit = 7;
  int32 postal_code = 8;
  string city = 9;
}

message RegisterCustomerResponse
{
  Customer customer = 1;
  Address address = 2;
  Postal postal = 3;
}

message GetCustomerRequest
{
  int32 customer_id = 1;
}

message GetCustomerResponse
{
  NonSensitiveCustomerInfo customer = 1;
}

message Empty { }

message GetAllCustomersRequest
{
  Empty empty = 1;
}

message NonSensitiveCustomerInfo
{
  int32 id = 1;
  string first_name = 2;
  string last_name = 3;
  string email = 4;
  string phone_number = 5;
  repeated Address addresses = 6;
  repeated Postal postals = 7;
  bool can_sell = 8;
}

message GetAllCustomersResponse
{
  repeated NonSensitiveCustomerInfo customers = 1;
}

message UpdateCustomerRequest
{
  int32 customer_id = 1;
  string first_name = 2;
  string last_name = 3;
  string email = 4;
  string phone_number = 5;
  string street_name = 6;
  string secondary_unit = 7;
  int32 postal_code = 8;
  string city = 9;
}

message UpdateCustomerResponse
{
  int32 id = 1;
  string first_name = 2;
  string last_name = 3;
  string email = 4;
  string phone_number = 5;
  repeated Address addresses = 6;
  repeated Postal postals = 7;
}

// use case for "Register" (only customer)
service CustomerRegisterService
{
  rpc RegisterCustomer (RegisterCustomerRequest) returns (RegisterCustomerResponse);
}

// use case for "Show Customer Details"
service GetCustomerService
{
  rpc GetCustomer (GetCustomerRequest) returns (GetCustomerResponse);
  rpc GetAllCustomers (GetAllCustomersRequest) returns (GetAllCustomersResponse);
}

// use case for "Edit Customer Details"
service UpdateCustomerService
{
  rpc UpdateCustomer (UpdateCustomerRequest) returns (UpdateCustomerResponse);
}

// use case for "Upload Product Details" (include getter of products)
message UploadProductRequest
{
  double price = 1;
  string condition = 2;
  string name = 3;
  repeated string image_url = 4;
  Category category = 5;
  string description = 6;
  string other_category = 7;
  int32 sold_by_customer_id = 8;
}

message UploadProductResponse
{
  Product product = 1;
  repeated Image images = 2;
}

message GetProductRequest
{
  int32 product_id = 1;
}

message GetProductResponse
{
  Product product = 1;
  NonSensitiveCustomerInfo customer = 2;
  repeated Image images = 3;
  Pawnshop pawnshop = 4;
  Address pawnshop_address = 5;
  Postal pawnshop_postal = 6;
}

message GetAllProductsRequest
{
  Empty empty = 1;
}

message ProductWithFirstImage
{
  Product product = 1;
  Image first_image = 2;
}

message GetAllProductsResponse
{
  repeated ProductWithFirstImage products = 1;
}

message GetPendingProductsRequest {
  Empty empty = 1;
}

message GetPendingProductsResponse {
  repeated ProductWithFirstImage products = 1;
}

message GetAllAvailableProductsRequest {
  Empty empty = 1;
}

message GetAllAvailableProductsResponse {
  repeated ProductWithFirstImage products = 1;
}

message GetAllReviewingProductsRequest {
  Empty empty = 1;
}

message GetAllReviewingProductsResponse {
  repeated ProductWithFirstImage products = 1;
}

// service for "Upload Product Details" and "Get Product Details"
service UploadProductService
{
  rpc UploadProduct (UploadProductRequest) returns (UploadProductResponse);
}

service GetProductService
{
  rpc GetProduct (GetProductRequest) returns (GetProductResponse);
  rpc GetAllProducts (GetAllProductsRequest) returns (GetAllProductsResponse);
  rpc GetPendingProducts (GetPendingProductsRequest) returns (GetPendingProductsResponse);
  rpc GetAllAvailableProducts (GetAllAvailableProductsRequest) returns (GetAllAvailableProductsResponse);
  rpc GetAllReviewingProducts (GetAllReviewingProductsRequest) returns (GetAllReviewingProductsResponse);
}

// use case for "Product Inspection by Reseller"

message Inspection
{
  int32 id = 1;
  int32 product_id = 2;
  int32 inspected_by_reseller_id = 3;
  google.protobuf.Timestamp inspection_date = 4;
  string comments = 5;
  bool is_accepted = 6;
}

message Pawnshop
{
  int32 id = 1;
  string name = 2;
  int32 address_id = 3;
}

message ProductInspectionRequest
{
  int32 product_id = 1;
  int32 reseller_id = 2;
  string comments = 3;
  bool is_accepted = 4;
  int32 pawnshop_id = 5;
}
message ProductInspectionResponse
{
  int32 product_id = 1;
  ApprovalStatus approvalStatus = 2;
  int32 pawnshop_id = 3;
}
message ProductVerificationRequest
{
  int32 product_id = 1;
  int32 reseller_id = 2;
  bool is_accepted = 3;
  string comments = 4;
}
message ProductVerificationResponse
{
  int32 product_id = 1;
  ApprovalStatus approvalStatus = 2;
}
service ProductInspectionService {
  rpc ReviewProduct (ProductInspectionRequest) returns (ProductInspectionResponse);
  rpc VerifyProduct (ProductVerificationRequest) returns (ProductVerificationResponse);
}

// use case for "Buy Products"
service PurchaseService
{
  rpc BuyProducts (BuyProductsRequest) returns (BuyProductsResponse);
}

// use case for login (customer)
message CustomerLoginRequest
{
  string email = 1;
  string password = 2;
}
message CustomerLoginResponse
{
  int32 customer_id = 1;
  string first_name = 2;
  string last_name = 3;
  string email = 4;
  string phone_number = 5;
  bool can_sell = 6;
}
service CustomerLoginService
{
  rpc Login(CustomerLoginRequest) returns (CustomerLoginResponse);
}

message ResellerLoginRequest
{
  string username =1;
  string password =2;
}

message ResellerLoginResponse
{
  int32 id = 1;
  string username =2;
}

service ResellerLoginService
{
  rpc Login(ResellerLoginRequest) returns (ResellerLoginResponse);
}

// use case for customer to enable selling ("inspect customer details")
message EnableSellingRequest
{
  int32 customer_id = 1;
  bool can_sell = 2;
}
message EnableSellingResponse
{
  int32 customer_id = 1;
  bool can_sell = 2;
}
service CustomerInspectionService
{
  rpc SetCanSell(EnableSellingRequest) returns (EnableSellingResponse);
}