@page "/available-product"
@using ApiContracts.Dtos
@using BlazorApp.Services.Interface
@rendermode InteractiveServer
@inject IGetProductService GetProductService
@inject NavigationManager NavigationManager

@code 
{
	//attributes for product list
	private IQueryable<ProductWithFirstImageDto>? _products;
	private string _addToCartMessage = "";

	protected override async Task OnInitializedAsync()
	{
		_products = await GetProductService.GetAllAvailableAsync();
	}

	private void AddProductToCart(int productId)
	{
		// implement cart addition logic here
		_addToCartMessage = $"Product with ID {productId} added to cart. (not implemented)";
	}
}

@* <style>
	.product-list {
		display: flex;
		flex-direction: column;
		gap: 16px;
	}

	.product-row {
		display: flex;
		align-items: center;
		gap: 16px;
	}

	.product-card {
		display: flex;
		align-items: center;
		padding: 16px;
		width: 65vw;
		border: 1px solid #ccc;
		border-radius: 8px;
		transition: background 0.2s;
		text-decoration: none;
		color: inherit;
	}

		.product-card:hover {
			background: #f0f0f0;
		}

	.product-image {
		width: 150px;
		height: auto;
		margin-right: 16px;
	}

	.product-details {
		flex: 1;
	}

	.product-price {
		font-weight: bold;
		margin-left: 16px;
	}

	.add-to-cart {
		padding: 10px 20px;
		background: #007bff;
		color: #fff;
		border-radius: 6px;
		cursor: pointer;
		user-select: none;
		transition: background 0.2s;
	}

		.add-to-cart:hover {
			background: #0056b3;
		}
</style> *@

<link href="css/AvaliableProduct.css" rel="stylesheet" />

<h3>Buy Products here</h3>

<p>@_addToCartMessage</p>

@if (_products == null)
{
	<p>Loading...</p>
}
else
{
	<div class="product-list">
		@foreach (var product in _products)
		{
			<div class="product-row">
				<NavLink class="product-card" href="@($"/products/{product.Id}")">
					@if (product.Image != null)
					{
						<img class="product-image" src="@product.Image.Url" alt="@product.Name" />
					}
					else
					{
						<span class="product-image">No Image</span>
					}
					<div class="product-details">
						<div><strong>@product.Name</strong></div>
						<div>@product.Description</div>
					</div>
					<div class="product-price">@product.Price DKK</div>
				</NavLink>
				<div class="add-to-cart" @onclick="() => AddProductToCart(product.Id)">Add to cart</div>
			</div>
		}
	</div>
}