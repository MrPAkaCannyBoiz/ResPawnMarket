@page "/customer/update/{id:int}"
@using ApiContracts.Dtos
@using ApiContracts
@inject BlazorApp.Services.ICustomerServices CustomerServices
@inject BlazorApp.Services.IUpdateCustomerService UpdateCustomerServices
@rendermode InteractiveServer

@code 
{
	[Parameter] public int id { get; set; } // Customer ID from route parameter

	private CustomerDto? customerToUpdate;
	private string updateMessage = string.Empty;
	private string loadMessage = string.Empty;
	private string FirstName = string.Empty;
	private string LastName = string.Empty;
	private string Email = string.Empty;
	private string PhoneNumber = string.Empty;
	private string StreetName = string.Empty;
	private string SecondaryUnit = string.Empty;
	private string City = string.Empty;
	private int postalCode;
	private bool showConfirmation = false;

	protected override async Task OnInitializedAsync()
	{
		try
		{
			customerToUpdate = await CustomerServices.GetSingleAsync(id);
			if (customerToUpdate != null) // Pre-fill form fields with existing customer data
			{
				FirstName = customerToUpdate.FirstName;
				LastName = customerToUpdate.LastName;
				Email = customerToUpdate.Email;
				PhoneNumber = customerToUpdate.PhoneNumber;
				StreetName = customerToUpdate.StreetName;
				SecondaryUnit = customerToUpdate.SecondaryUnit;
				City = customerToUpdate.City;
				postalCode = customerToUpdate.PostalCode;
			}
		}
		catch (Exception ex)
		{
			loadMessage = $"Error loading customer: {ex.Message}";
		}
	}

	private async Task UpdateCustomerGivenId()
	{
		if (customerToUpdate == null)
		{
			updateMessage = "Customer data is not loaded.";
			return;
		}
		var updateDto = new UpdateCustomerDto
		{
			FirstName = FirstName,
			LastName = LastName,
			Email = Email,
			PhoneNumber = PhoneNumber,
			StreetName = StreetName,
			SecondaryUnit = SecondaryUnit,
			City = City,
			PostalCode = postalCode
		};
		try
		{
			await UpdateCustomerServices.UpdateCustomerAsync(id, updateDto);
			updateMessage = "Customer updated successfully.";
		}
		catch (Exception ex)
		{
			updateMessage = $"Error updating customer: {ex.Message}";
		}
	}

}

<h3>Update Customer</h3>
@if(customerToUpdate != null)
{
	<div>
		<label>First Name:</label>
		<input @bind="FirstName" />
	</div>
	<div>
		<label>Last Name:</label>
		<input @bind="LastName" />
	</div>
	<div>
		<label>Email:</label>
		<input @bind="Email" />
	</div>
	<div>
		<label>Phone Number:</label>
		<input @bind="PhoneNumber" />
	</div>
	<div>
		<label>Street Name:</label>
		<input @bind="StreetName" />
	</div>
	<div>
		<label>Secondary Unit:</label>
		<input @bind="SecondaryUnit" />
	</div>
	<div>
		<label>City:</label>
		<input @bind="City" />
	</div>
	<div>
		<label>Postal Code:</label>
		<input type="number" @bind="postalCode" />
	</div>
	<button @onclick="() => showConfirmation=true">Update Customer</button>
	@if (showConfirmation)
	{
		<div class="confirmation-dialog">
			<p>Are you sure you want to update this customer?</p>
			<button @onclick="async () => { await UpdateCustomerGivenId(); showConfirmation = false; }">Yes</button>
			<button @onclick="() => showConfirmation = false">No</button>
		</div>
	}
	<p>@updateMessage</p>
}
else
{
	<p>@loadMessage</p>
}


